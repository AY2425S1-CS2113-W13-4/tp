a@startuml
!include Style.puml
actor user
participant ":TutorLink" as TL LOGIC_COLOR_5
participant ":Ui" as UI LOGIC_COLOR_6
participant ":Parser" as P LOGIC_COLOR_7
participant ":XYZCommand" as C LOGIC_COLOR_3
participant ":AppState" as A LOGIC_COLOR_2
participant ":Storage" as S LOGIC_COLOR_4

activate TL
TL->UI: displayWelcomeMessage()
activate UI
TL <-- UI
deactivate UI

create S

alt success
    TL -> S : new StudentComponent, ComponentStorage, GradeStorage
    activate S
    TL <-- S : StudentComponent, ComponentStorage, GradeStorage
    deactivate S

    TL -> S : loadStudentList(), loadComponentList(), loadGradeList()
    activate S
    TL <-- S : ArrayList<Student>, ArrayList<Component>, ArrayList<Grade>
    deactivate S

    create A
    TL -> A : new AppState(ArrayList<Student>, ArrayList<Component>, ArrayList<Grade>)
    activate A
    TL <-- A : appState
    deactivate A
else exception
        TL -> UI : displayException
        activate UI
        TL <-- UI
        deactivate UI
end

deactivate UI
loop until exit command issued
    user -> TL:"<command> <arguments>"
    TL -> UI: getUserInput()
    activate UI
    TL <-- UI: line
    deactivate UI
    TL -> P : getCommand(line)
    activate P
    create C
    P -> C
    activate C
    P <-- C : XYZCommand
    deactivate C
    TL <-- P: XYZCommand
    deactivate P
    TL -> C : getArgumentPrefixes()
    activate C
    TL <-- C : argumentPrefixes
    deactivate C
    TL -> P: getArguments(argumentPrefixes, line)
    activate P
    TL <-- P : HashMap<String,String>
    deactivate P
    TL -> C : execute(appState, arguments)
    activate C
    ref over C, A : specific command execution
    alt success
        TL <-- C : CommandResult
        deactivate C
        TL -> UI : displayResult
        activate UI
        TL <-- UI
        deactivate UI
    else exception
        TL -> UI : displayException()
        activate UI
        TL <-- UI
        deactivate UI
    end
    TL -> TL : saveAllLists()
    activate TL
    TL -> S : save Student, Component and Grade Lists
    activate S
    TL <-- S
    deactivate S
    TL --> TL
    deactivate TL
end
TL->UI: displayGoodbyeMessage()
activate UI
TL <-- UI
deactivate UI
user <-- TL
deactivate TL
@enduml